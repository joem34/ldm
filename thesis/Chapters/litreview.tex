\chapter{Introduction}
\section{Overview}
Ministry of Transportation in Ontario is in the process of developing a new provincial transport model, and one important component is the disaggregate long distance travel model. Statistics Canada estimate that around 100 million long distance trips are performed every year that interact with Ontario, totally over 45 billion kilometers traveled. The choice of destination is the key determinate of the length of a trip, and as such, an accurate destination choice model is vital to a working long distance model. This thesis presents the creation of a multinomial logit (MNL) model for long distance destination choice in Ontario. As an additional novel contribution, big data from the location based social network foursquare is used to improve the representation of destination attractiveness, particularly for leisure purposes.

Most of the literature on transport demand modeling focuses on urban mobility and regular travel patterns such as commuting and shopping. It is important that the study of long distance travel behavior is not neglected. \textcite{rohr2010modelling} found that in Great Britain, "Trips over 50 miles in length account for just 2.3\% of all trips, but about a third of all distance traveled". Furthermore, with  consensus on the existence of climate change in the scientific community, the environmental impact of long distance trips needs to be quantified. 

The ability to travel long distances, for business or personal reasons, also depends on large amounts of infrastructure such as highways, airports and railways. Such infrastructure is expensive, and can take decades, and billions of dollars, from the concept to implementation. It is also hard to alter after it is put in place. It is important to understand the potential impacts of such projects. Should be a rail line or highway be built? Where should it start and end? What capacity is needed? These questions are hard to answer, precisely because they are questions about the future, and involve the collective impacts of the mobility behaviors of millions of unique individuals. To investigate these questions, transport planners need to be able to observe, visualize, understand and forecast where, why and how people travel. 

The structure of this thesis is as followed. Chapters 1 and 2 presents an introduction to the topic a review of the relevant literature. Chapter 3 details the data sources used in the model, and describes the methodology for the collection of foursquare data. A gravity model is implemented in chapter 4 as a baseline to judge the effectiveness of destination choice models. Chapter 5 covers the estimation, implementation and application of the destination choice model. Finally, chapters 6 provides a discussion of the results and their relevance.
	
\section{Behavioral Models}
Travel behavior is based on a series of choices; if the individual travels, where they travel to, and how they make the journey. Each individual takes different factors into account in their decision making process. How someone chooses to travel depends not just on concrete facts such as the location of the workplace and auto ownership, but also the daily weather, their schedule, personal preference of different transport modes and even just their current mood.

Since we cannot hope to replicate the decision making process of every individual exactly, particularly in the response to future changes in their environment,  we use behavioral models to simplify, define and quantify human behavior and its impacts. We can either consider the population as a whole (aggregate modeling), or predict the choice of each individual (disaggregate modeling). The respective benefits of the two approaches are discussed more in section~\ref{section:lit-review}.

Where the disaggregate modeling of human behavior involves making a choice between alternatives, such as a destinations for a journey, or transport mode, discrete choice models can be used. In such scenarios, only one alternative can be selected. A person cannot travel to two places at the exact same time. Discrete choice models calculate the probability that an individual chooses a particular alternative. It is then assumed that each individual will choose the alternative that provides the highest utility. The resulting model can only be probabilistic in nature as in practice, complete information on the individual and the alternatives is lacking. Although the individual choice may not be exact, when the model is applied  over a whole sample population, the results become reasonable.  

\section{Foundations of transport modeling}
When modeling mobility behaviour, we seek to answer 5 key questions; if people travel and where they travel from, where they travel to, how they travel, and what route they take on the journey. These questions form the 4 steps of the traditional transport model. The four step model has been standard in transport modelling practice since the 1960's~\parencite{de1994modelling}. 

The classic 4 step model works as an aggregate process. In trip generation, a trip vector listing of the number of trips from each origin is constructed. In the second step, trip distribution, an OD matrix is calculated, which can be constrained by the number of expected incoming trips at each destination, or by attributes of the destination, such as population. In the third step, the mode share (of auto, bus, train) for each OD pair is calculated. Finally, a route assignment is performed to allocate these trips to the transport network. 

Advances in modeling techniques and computing have made fully disaggregate models based on the 4-step method feasible for large scale models. A list of trips is generated using a sample population and statistical model. A destination, mode and route are then predicted and assigned to each trip. For a large model, this can require the generation, storing, and processing of tens of millions of individual trips. Feedback loops are also often included to consider the inter-related influences of each step, such as the effect of congestion. Numerous researchers have found that mode choice influences destination choice, and there are two common approaches that can be taken to account for this. The logsum of the mode choice model is included as a parameter in destination choice \parencite{jonnalagadda2001development, mishra2011functional} or a combined destination-mode-choice model is calculated \parencite{newman2010hierarchical, adler1976joint, boyce1983implementation, Outwater15}

\section{Big data in transport modeling}
Big data is the topic-du-jour in the fields of data analysis and transport modeling. There is no clear delineation between `normal data' and `big data'. However, it has come to be defined by the four v's: volume, velocity, variety and veracity \parencite{beyer2012importance}. It is these characteristics that make it attractive as a data source for transportation modeling, particularly volume and veracity. Traditional transport models still rely on travel surveys and census data. Even comprehensive travel surveys such as the TSRC in canada  often have a sample size of only around 50,000 records per year, and there is no standard survey methodology or output. On the other hand, big data sources can track the movements of millions of individuals (volume), providing unprecedented spatial and temporal accuracy (veracity). Furthermore, the format of many common big data sources, such as cell phone records and geotagged social media interactions are standard, reducing the effort needed to define models around the data available. In some recent examples, GPS data is increasingly being incorporated into various transport models, particularly destination choice \parencite{schonfelder2006analysis, pan2006cellular} and route assignment \parencite{broach2012cyclists, menghini2010route}.

While there has been a "virtual explosion of data availability" ~\textcite{nagel2001workshop},  ~\textcite{horni2012improve} note that  the collection of big data such as GPS and GSM data "is generally associated with privacy, cost and technical issues".  These challenges go against the ideal of general models that are flexible and transferable \parencite{patriksson2015traffic}. None the less, big data undoubtedly has a role to play in the future of transport modeling. \textcite{rth2015} suggests further research into probabilistic models based on big data, and the blending of big data with data from travel diaries would be useful. 

\chapter{Literature Review}
\label{section:lit-review}
Also known as Intercity models, long-distance transport models were first proposed in the 1960’s, with two of the earliest being developed in the United States and Canada respectively \parencite{CTC71}. These models were comparatively basic, with the demand component of the model only incorporating zonal population and income as attraction measures, and trip time, cost and convenience as impedance measures. More recent demand models include attributes such as auto ownership and household size. 

Long-distance models are commonly defined to contain trips of certain length or longer, as opposed to the much more common urban model. TRB's NCHRP Report 735 notes that current state-wide models and travel surveys in the United States have used a range of thresholds to define long-distance trip-making, \enquote{either 50, 75, or 100 miles as the minimum threshold for trips to be considered long-distance.}\autocite{schif12}

According to \textcite{miller04}, a distinct class of intercity travel demand models exist, which have unique characteristics when compared to urban models. \enquote{An intercity travel demand model is designed to forecast travel demand between two or more urban areas ... rather than travel within a given urban region}. He also highlights two main features of such models. Firstly, he argues that an intercity travel demand model should apply to a well-defined travel corridor, containing a small number of major cities. Secondly he suggests that such models are almost always designed to model the impact of new travel modes such as high speed rail, or other policy initiatives.

Miller also notes that while urban models and methods are well documented in open literature, and applied in published policy analysis, intercity models are often the intellectual property of the consultants involved. The models are infrequently published in the scientific literature, and the travel data on private travel modes is often closely guarded, meaning that the models are often hard to replicate, if they are published at all. It follows that \enquote{intercity travel demand models tend to be a less attractive/feasible application area for academic researchers than the more data-rich urban field.} \parencite{miller04}

\section{Aggregate intercity transport models}

Until the 1980’s, intercity transport models were exclusively designed as aggregate models, which distributed trips between origin-destination pairs and modes using the gravity model proposed by \autocite{casey55}. However, as early as 1962, the deficiencies in this approach were identified by numerous researchers \autocite*{OiSchu62, Warner62}. In 1967, \autocite{Wilson67} first proved the theoretical validity of the gravity model, following two decades of its use in practice. These theoretical foundations encouraged further use of the gravity model in the development of transport demand models. 

\section{Discrete destination choice models}
Despite their widespread acceptance and use in practice, the aggregate gravity model has some fundamental flaws as a modelling methodology. As an alternative, \textcite*{McFadden73, Akiva74} proposed the use of the logit model as a disaggregate method to model travel demand. McFadden, in his pioneering paper, noted that \enquote{When the model of choice behaviour under examination depends on unobserved characteristics in the population, the testable implications of the individual choice model are obscured.}\parencite{McFadden73}

Further research focused on the use of disaggregate models for the trip distribution step of the classic four step model. These came to be known as destination choice models, the focus of this thesis. A thorough investigation of the suitability of discrete choice models as opposed to aggregate methods for transportation modelling was conducted by \textcite{Spear77}. Spear noted that the 
\begin{itemize}
\item Individual choice models are more data efficient than conventional (i.e. gravity) models.
\item They can utilize the variation in socioeconomic data much better, to avoid ecological fallacies.
\item The probabilistic nature of the dependent variable allows for the modeling of interdependent choices, such as mode choice and trip chaining decisions. 
\end{itemize}
	
Since then, the application of disaggregate models in transport demand modeling has been continually refined, with important research done in both modeling destination choice and mode choice in this manner. \textcite{Daly82} focused on representing the attractiveness of a destination in a destination choice model, while further work was done by \textcite{Akiva74} and \textcite{Anas81} in defining the structure and application of such models. \textcite{Train09} comments that \enquote{discrete choice models cannot be calibrated using a simple curve fitting, as since the dependent variable, as a probability cannot be observed}. Instead, maximum likelihood estimation is most commonly used. Since the utility of every alternative must be calculated, this technique was prohibitive for large scale problems before the advent of modern computers. This may go some way to explaining the persistent popularity of aggregate models, due to their simplified computational requirements.

In chapter 9 of Discrete Choice Analysis, {AkivaLerman85} present a comprehensive discussion of destination choice models. They note that \enquote{destination choice is characterized by a very large number of alternatives}, and the selection of resolution of the choice set is a very important consideration. They further discuss the challenge of data availability for destination attractiveness. Since the attractiveness of data is not always available at a destination level, \enquote{the alternatives in a destination choice model must be based on aggregate alternatives}. Even with the modern GPS and social data available to the modern modeler, this is clearly still an issue. This is an important point that Ben-Akiva and Lerman make, that while destination choice models can model the decisions of individual travelers, they still need to rely on some level of aggregation for modeling the utility of each destination.

\textcite{simma2001destination} developed a destination choice model for leisure travel in Switzerland that considered many variables of destination attractiveness such as the number of swimming pools, ski area qualities and land use attributes. They found that while the distance terms played the most significant role, measures of destination attractiveness were still important and improved the model. 

Discrete choice models have been repeatedly shown to provide better results than aggregate methods when modeling travel behavior \parencite*{Stephanedes84, Mishra13} compared the gravity model and multinomial logit destination choice model when integrated into a model for Maryland. They found that the destination choice model performed much better than the gravity model for a state-wide travel demand model. 

\section{Trip chaining}
\textcite{AdlerAkiva79} were one of the first to model the inter-dependencies between links in a trip chain. They defined a theoretical and empirical model of trip chaining behavior to do so, based on utility theory, and accounting for the tradeoffs involved in multi-step chain trips. They, like most researchers in the area, focus on daily travel patterns within urban models. However, they note that \enquote{It is important that the determinants of non-work travel patterns that include multiple-sojourn tours be better understood}. To do this, they model the utility to a given household of a particular travel pattern as a function of scheduling convenience, activity duration, income, destination attributes and socioeconomic characteristics of the household.
One of the significant advantages of a disaggregate destination model is the ability to model tours. Due to the nature of the data, trip chaining commonly isn't included in long distance travel models. \textcite{Moeckel15} considered its inclusion, however the proportion of multi-link trips was found to be too small, and the trip lengths between stops were not recorded in the National Household Travel Survey (NHTS) data they used. 

\textcite{Kitamura84} incorporated trip chaining directly into an analysis of destination choice. He used an approach called Prospective Utility that \enquote{represents the expected utility of the visit to that zone and also those visits that may be made}. In essence, this theory postulates that with two destinations A and B of equal utility, opportunity B will be more attractive that A to a trip maker when it is surrounded by destinations supporting other opportunities that the trip maker wishes to pursue.

\section{Recent long distance transport models}
\autocite{Outwater10} developed a state-wide model to model high speed rail. They combined both stated and revealed preference data in their attributes. For destination choice, they looked at destination attraction, employment and household characteristics, the region and area type, trip purpose, distance class, and party size. While not a combined destination-mode choice model, they combine some network data to calculate auto and non-auto accessibility, for peak and off-peak respectively. Destination was estimated using a simple multinomial logit model. The authors also note that their modeling shows \enquote{that an individual may value different trip characteristics for different distance-categories of travel}. They also modeled the area type of a zone, as rural, suburban or urban. Interaction terms were also created between zones, under the assumption that urban to urban trips are much more common.

More recently, models are also being designed on a larger, more ambitious scale. One such example is the new national model of long-distance travel in the United States \parencite{Outwater15}. This model focuses includes multiple advancements on previous models, including modeling at an individual household level, a high level of spatial detail for destination choice, and the vertical integration of all 4 steps of the transport model. Unlike activity based models, it uses a temporal resolution of months and weeks, not days, and jointly predicts destination and mode choice together. 

\section{Mnlogit R package}
\label{section:mnlogit-structure}
\label{section:mnlogit}
In this thesis, the R package \textit{mnlogit} \parencite{hasan2014fast} is used to estimate a multinomial model of destination choice. While the input formats are the same as the original \textit{mlogit} package, \textit{mnlogit} requires less computer memory usage, allowing for more model parameters. It also performs the maximum likelyhood estimation in parallel for significant decrease in estimation runtime.
\subsection*{Data format}
The model input must be provided in a long format. The format of the input can described as followed:
Let \(S\)  be the set of input trips, and \(R\)  be the total choice set of possible destination alternatives. 

For each trip $s \in S$, an arbitrary choice set $R_s$ is required, where
$$ R_s  =  \{a | R_s \subseteq R \wedge \exists t \in S : destination(t) = a \} $$ 
The model input is then constructed by adding a row for each trip $s$ and alternative $a \in R_s$, giving a total number of rows  $ \sum_{s \in S} |R_s| $  for the model input. A boolean column is also added that indicated whether a particular choice was chosen for that trip or not.

\subsection*{Formula Specification}
The \textit{mnlogit} package accepts model formulas structured using the R formula package. A mlogit formula consists of 4 parts: $ choice \sim Y | X | Z $ , where $X,Y,Z$ are as followed:

\begin{itemize}
	\item Choice: the LHS of the equation, the column that indicates if an alternative was chosen or not.
	\item $X$: Individual $i$ specific variables with alternative $k$ specific coefficients $\vec{X_i} ∙\vec{\beta_k}$.

	\item $Y$: Alternative specific variables with alternative independent coefficients $\vec{Y_ik} ∙\vec{\alpha}$. 
	\item $Z$: Alternative specific variables with alternative specific coefficients
$\vec{Z_ik} ∙\vec{\gamma_k}$.
\end{itemize}

In the context of destination choice, individual variables are those such as income, gender and education level that pertain to the traveler. A coefficient must be estimated for every destination, as the value of the individual vary does not vary across the choice set for each trip, only between trips. Alternative specific variables can have coefficients independent or dependent of the choice set. The coefficient only needs to be dependent on the alternative $Z$ when the parameter has a different meaning across the choice set. This is more commonly used in mode choice modeling; for example, the calculation of cost might vary between car and train journeys.

Parts of the equation can also be excluded by specifying $0$ or $-1$ in the respective section. Intercepts can also be removed by adding $+ 0$ to the in the same way. The estimation will return an error if the equation cannot be solved, and the most common reason for this is high multi-colinearity between parameters specified in the model.

\section{Location based social networks}
The ubiquity of mobile GPS transceivers, especially in the smart phone market, has enabled a new category of social networks, called location based social networks (LBSN), which associate social networking data with a geo-referenced location. Different social networks have taken advantage of this opportunity in different ways. Facebook enables a user to mark themselves as safe during a natural disaster, flicker can show a map of where your images were taken, and google maps can provide accurate travel times by identifying areas of congestion. 

Most location based social networks, such as Facebook, Tripadvisor and Foursquare enable users to 'checkin' to a 'venue', such as a shop, tourist attraction or airport, and provide tips, ratings and reviews. When these services are used by millions of people around the world, in different countries and cities, a enourmous amount of data is collected, which can be used in a multitude of ways to explore mobility patterns. 

\textcite{lindqvist2011m} looked at how and why people use location sharing services such as foursquare, and discussed how users manage their privacy when using such services. \autocite{cheng2011exploring} collected 22 million checkins across 220,000 users to quantitatively assess human mobility patterns. 53\% of their checkins came from foursquare, highlighting the dominance of foursquare in the LSBN space. They sampled location sharing status updates from the public Twitter feed, identifying users with geo-referenced tweets, and then collected the most recent 2000 geo-labeled tweets.

\textcite{noulas2012tale} used foursquare data to design gravity model based on Stouffer's theory of intervening opportunities. They found that while no universal law exists between mobility and distance, a universal behavior in all cities when measured with their rank-distance variable exists. Regarding the potential applications of LBSNs in future research, they note that the scale of data collected by foursquare provides the means to analyse and compare mobility patterns in different parts of the world, surpassing cultural, geographical and political borders. They also warn \enquote{there may be a strong demographic bias in the community of Foursquare users}, before noting that \enquote{it is encouraging that the analysis and models developed in the context of the present work demonstrate strong similarities across multiple urban centers and different countries.}

\textcite{abdulazim2015framework} introduces a framework for inferring activity travel given nearby land use information gathered from LSBNs. Their results suggest that daily activity travel can be automatically inferred from LSBN data, and they present a generic method for acquiring land use data from LSBN services such as foursquare. The authors also present a case study for the  greater Toronto and Hamilton area, Ontario, Canada, a subset of the study area for this thesis.
\textcite{sa2015origin} investigated the potential for cell phone and foursquare data to replace the use of Travel Surveys in calculating and Origin Destination Demand matrix. They found that The cell phone and Foursquare data were consistent with OD pairs expected to have higher trip volumes, but that some differences existed.
\textcite{jin2014location} proposed a doubly constrained gravity model based on LBSNs. They were able to achieve significant reductions in O-D estimation errors caused by sampling bias when compared to a singly constrained model.

\section{Objectives}
Disaggregate models provide clear advantages over aggregate methods in modeling trip distribution. While aggregate methods still hold sway in the modeling of long distance travel, due to the availability of data and more powerful computers, the modeling of destination choice using logit models is becoming more popular. Destination choice models provide more flexibility in attribute selection, and more efficient use of data. Most models include the basic socioeconomic variables and a description of zone attractiveness. 

It is often difficult or simply not appropriate to take a model that has been designed for another geographical region and apply it in study area of concern. Firstly, the data available for the study area will most likely be different to those available for other study areas. The data may provide more variables that were not available to modelers working in other regions, or be more restricted, forcing the modeler to be creative in designing parameters that can represent the travel behavior. Secondly, it is very difficult to design accurate models that work effectively when transposed to new study areas. This is due not just to obvious geographical differences, but variations in policy and culture that are difficult to reflect in a destination choice model. If every possible parameter reflecting was added to the model, not only would it be computationally infeasible, but there would be a high risk of over-fitting in the model. The fact that the destination choice models already presented in the literature are individually unique supports this notion that modeling is both a science and an art, and that there is no \enquote{one size fits all} model.

For these reasons, the design of a destination choice model for Ontario in itself reflects a new contribution to the field.  The field of transport modeling advances every time a new model is designed, implemented and evaluated. Future researchers can then look at the body of previous models, and use statistical analysis, their experience and intuition to select variables that best suit the requirements and use cases for which their model will be designed. 

The second contribution of this thesis is the application of LSBNs to improve the utility modeling of destination choice. While work has been done on investigating mobility patterns, and the generation of OD matrices using LSBNs, their application to disaggregate models in transport has not been considered. This thesis will explore how foursquare check-in data can be used in the calculation of destination utility. Check-in data also provides an opportunity to model important traits of destination utility, such as the presence of national parks, that are not reflected in standard socioeconomic variables.

